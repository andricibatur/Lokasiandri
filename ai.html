<!DOCTYPE html><html>
<head>
  <meta charset="UTF-8">
  <title>Aplikasi AI Multi-Laporan</title>
  <style>
    body { font-family: sans-serif; margin: 15px; }
    section { border: 1px solid #ccc; padding: 10px; margin-bottom: 15px; }
    textarea { width: 100%; box-sizing: border-box; margin-top: 5px; }
    .controls { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
    .result { background: #f9f9f9; padding: 10px; margin-top: 10px; border: 1px solid #bbb; white-space: pre-wrap; }
    button { padding: 6px 12px; border-radius: 4px; border: none; cursor: pointer; }
    button:hover { opacity: 0.9; }
  </style>
</head>
<body><h2>Aplikasi Catatan & Laporan AI</h2><section id="section-financial">
  <h3>✍️ Catatan Keuangan</h3>
  <textarea id="input-financial" placeholder="Contoh: 25 Jun - Jual kambing 2jt [+]&#10;25 Jun - Beli pakan 150rb [-]"></textarea>
  <div class="controls">
    <button onclick="simpan('transaksi')">💾 Simpan Keuangan</button>
    <button onclick="tanyaAI('transaksi')">🤖 Laporan Keuangan</button>
  </div>
  <div id="result-transaksi" class="result">(belum ada ringkasan)</div>
</section><section id="section-schedule">
  <h3>📅 Catatan Jadwal</h3>
  <textarea id="input-schedule" placeholder="Contoh: 26 Jun - Rapat proyek jam 10:00"></textarea>
  <div class="controls">
    <button onclick="simpan('jadwal')">💾 Simpan Jadwal</button>
    <button onclick="tanyaAI('jadwal')">🤖 Laporan Jadwal</button>
  </div>
  <div id="result-jadwal" class="result">(belum ada ringkasan)</div>
</section><section id="section-notes">
  <h3>📝 Catatan Umum</h3>
  <textarea id="input-notes" placeholder="Contoh: Persiapan pasar ternak tanggal 30 Jun"></textarea>
  <div class="controls">
    <button onclick="simpan('notes')">💾 Simpan Catatan</button>
    <button onclick="tanyaAI('notes')">🤖 Laporan Catatan</button>
  </div>
  <div id="result-notes" class="result">(belum ada ringkasan)</div>
</section><script>
const API_KEY = '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'; // ganti dengan API Key Inul
const MODEL = 'deepseek/deepseek-chat-v3';
const MAX_TOKENS = 2000;

// Setup IndexedDB
let db;
const req = indexedDB.open('AppDB', 1);
req.onupgradeneeded = e => {
  db = e.target.result;
  ['transaksi','jadwal','notes','summaries'].forEach(storeName => {
    if (!db.objectStoreNames.contains(storeName)) {
      db.createObjectStore(storeName, { keyPath: 'id', autoIncrement: true });
    }
  });
};
req.onsuccess = e => { db = e.target.result; };
req.onerror = e => alert('IndexedDB gagal: ' + e.target.errorCode);

// Simpan catatan
function simpan(store) {
  const input = document.getElementById('input-' + store).value.trim();
  if (!input) return alert('Isi tidak boleh kosong.');
  const tx = db.transaction(store, 'readwrite');
  tx.objectStore(store).add({ content: input, time: Date.now() });
  document.getElementById('input-' + store).value = '';
  alert('Disimpan ke ' + store);
}

// Ambil semua catatan
function ambilSemua(store, cb) {
  const tx = db.transaction(store, 'readonly');
  tx.objectStore(store).getAll().onsuccess = e => {
    const arr = e.target.result.map(r => r.content);
    cb(arr.join('\n'));
  };
}

// Simpan ringkasan
function saveSummary(type, text) {
  const tx = db.transaction('summaries','readwrite');
  tx.objectStore('summaries').add({ type, summary: text, time: Date.now() });
}

// Kirim ke AI dan tampil/simpan hasil
async function tanyaAI(type) {
  const resultEl = document.getElementById('result-' + type);
  resultEl.textContent = '⏳ Menghubungi AI...';
  ambilSemua(type, async dataText => {
    const systemPrompts = {
      transaksi: 'Anda adalah asisten keuangan. Hitung total pemasukan, total pengeluaran, dan saldo akhir dari data berikut. Pemasukan ditandai [+], pengeluaran [-].',
      jadwal: 'Anda adalah asisten produktivitas. Buat ringkasan jadwal berikut dalam poin-poin urut berdasarkan waktu.',
      notes: 'Anda adalah asisten catatan. Ringkas poin-poin penting dari catatan umum berikut.'
    };
    try {
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + API_KEY,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          model: MODEL,
          messages: [
            { role: 'system', content: systemPrompts[type] },
            { role: 'user', content: dataText }
          ],
          max_tokens: MAX_TOKENS
        })
      });
      const data = await res.json();
      const reply = data.choices?.[0]?.message?.content || data.error?.message || 'Tidak ada balasan';
      resultEl.textContent = reply;
      saveSummary(type, reply);
    } catch (err) {
      resultEl.textContent = '❌ Error: ' + err.message;
    }
  });
}
</script></body>
</html>
